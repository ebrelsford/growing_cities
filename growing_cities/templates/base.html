<!DOCTYPE html>
{% load compress fiber_tags %}
<html>
<head>
	<meta charset="utf-8" />
	<title>{% block title %}{{ fiber_page.title }}{% endblock %}</title>
    <link rel="icon" href="{{ STATIC_URL }}img/favicon.ico" />

    {% compress css %}
	<link rel="stylesheet" href="{{ STATIC_URL }}css/base.css">
	<link rel="stylesheet" href="{{ STATIC_URL }}js/lib/chosen/chosen.css">
    {% endcompress %}

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.0/jquery-ui.min.js" type="text/javascript"></script>

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.css" />
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.ie.css" />
    <![endif]-->
    <script src="http://cdn.leafletjs.com/leaflet-0.5/leaflet.js"></script>

    {% block scripts %}{% endblock %}

    {% compress js %}
    <script type="text/javascript">
    WebFontConfig = { fontdeck: { id: '30649' } };

    (function() {
        var wf = document.createElement('script');
        wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
            '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
        wf.type = 'text/javascript';
        wf.async = 'true';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(wf, s);
    })();

    var client_ip = '{{ request.META.REMOTE_ADDR }}';
    </script>

    <!-- Dynamically load pages -->
    <script src="{{ STATIC_URL }}js/lib/jquery.scrollto.min.js"></script>
    <script src="{{ STATIC_URL }}js/lib/jquery.history.js"></script>
    <script defer src="{{ STATIC_URL }}js/jquery.ajaxpages.js"></script>  

    {% comment %}
    Only load jquery.form.js if not logged in--conflicts with Django Fiber 
    version. (TODO fix this?)
    {% endcomment %}
    {% if not fiber_page|can_edit:user %}
    <script defer src="{{ STATIC_URL }}js/lib/jquery.form.js"></script>  
    {% endif %}
    <script defer src="{{ STATIC_URL }}js/lib/jquery.placeholder.js"></script>  
    <script defer src="{{ STATIC_URL }}js/lib/jquery.smartresize.js"></script>  
    <script src="{{ STATIC_URL }}js/lib/jquery.waypoints.min.js"></script>
    <script src="{{ STATIC_URL }}js/lib/jquery.waypoints-sticky.min.js"></script>

    <script src="{{ STATIC_URL }}js/lib/chosen/chosen.jquery.min.js"></script>

    {% comment %}
    For Django Fiber code that uses bits jQuery no longer supports.
    {% endcomment %}
    <script src="{{ STATIC_URL }}js/lib/jquery-migrate-1.1.1.min.js"></script>

    <script src="{{ STATIC_URL }}js/main.js"></script>
    <script src="{{ STATIC_URL }}js/leaflet.offset.js"></script>
    <script src="{{ STATIC_URL }}js/leaflet.mapdrawer.js"></script>
    <script src="{{ STATIC_URL }}js/jquery.map.js"></script>
    {% if fiber_page|can_edit:user %}
    <script src="{{ STATIC_URL }}js/loggedin.js"></script>  
    {% endif %}
    {% endcompress %}
</head>
<body class="{% block body_class %}{{ fiber_page.title|slugify }}{% endblock %}">
	<div id="application-pane-wrapper">
	<div id="application-pane">
		<div>

			<div id="sidebar" class="full-height">
                <section id="logo">
                    <h1>
                        <a href="/">Growing<br />Cities</a>
                    </h1>
                </section>
				<nav id="mainmenu" class="clearfix">
					{% show_menu "mainmenu" 1 1 %}
				</nav>

                <div class="sidebar-section">
                    <a href="#" id="trailer-button">watch trailer</a>
                </div>

			</div>

            <div id="content-wrapper" class="full-height">
                <div id="content" class="full-height">
                    <article>
                        {% block content %}
                        {% show_page_content "main" %}
                        {% endblock %}
                    </article>
                </div>
			</div>

		</div>
        <div class="clear"></div>
	</div>

    <div class="terms">
        {% show_content "terms" %}
    </div>

    <div class="clear"></div>
	</div>

    <div id="buy-button">
        <div class="buy-button-inner">
            Buy the film
        </div>
    </div>

    <div class="full-height grid" id="map-drawer">
        <h2 class="map-drawer-title">Grow Where You Are</h2>

        <div class="map-drawer-section">
            <h3>Where are you?</h3>
            <select id="map-city">
                <option>Pick a city</option>
                {% for city in cities %}
                <option data-city="{{ city.city }}" data-state="{{ city.state_province }}">
                    {{ city.city }}, {{ city.state_province }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="map-drawer-section">
            <h3>What do you want to do?</h3>
            <select id="map-activities" disabled="disabled">
                <option>Everything</option>
            </select>
        </div>

        <div class="map-drawer-section">
            <h3>Results:</h3>
            <ul id="map-results"></ul>           
        </div>
    </div>

    <div class="full-height" id="map-overlay" style="display: none;">
        <div class="map-overlay-title">
            Grow Where You Are
        </div>
        <div class="map-overlay-description">
            Across the country, people are growing their own food. See what's growing near you.
        </div>
        <div class="button map-overlay-hide">
            GO
        </div>
    </div>

    {% block extra_markup %}{% endblock %}
</body>
</html>
